<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>臥推的孩子</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Source+Sans+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="/static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="/static/vendor/aos/aos.css" rel="stylesheet">
    <link href="/static/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
    <link href="/static/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

    <!-- Variables CSS Files -->
    <link href="/static/css/variables.css" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="/static/css/main.css" rel="stylesheet">
    <style>
        .chart-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
        }

        /* Chart Containers */
        .line-chart-container {
            width: 80%;
            max-width: 600px;
            height: 400px;
        }

        .pie-chart-container {
            width: 70%;
            max-width: 400px;
            height: auto;
        }

        .combo-chart-container {
            width: 90%;
            max-width: 800px;
            height: 400px;
        }

        .chart-container canvas {
            width: 100% !important;
            height: auto !important;
        }

        .button-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .button-container button {
            padding: 10px 20px;
            border: 1px solid #ccc;
            background-color: #f8f9fa;
            cursor: pointer;
        }

        .button-container button:hover {
            background-color: #e2e6ea;
        }

        /* Record Display Styles */
        .record-container {
            margin: 20px 0;
            text-align: left;
        }

        .record-container div {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
    </style>
</head>

<body>
    <!-- ======= Header ======= -->
    <header id="header" class="header fixed-top" data-scrollto-offset="0">
        <div class="container-fluid d-flex align-items-center justify-content-between">
            <a href="/" class="logo d-flex align-items-center scrollto me-auto me-lg-0">
                <h1><span><b>臥推</b></span><b>的孩子</b></h1>
            </a>

            <nav id="navbar" class="navbar">
                <ul>
                    <li><a class="nav-link scrollto" href="/">首頁</a></li>
                    <li><a class="nav-link scrollto" href="/profile/">個人資料</a></li>
                    <li><a class="nav-link scrollto" href="/detect">健身監測</a></li>
                    <li><a class="nav-link scrollto" href="/video/">教學影片</a></li>
                    <li><a class="nav-link scrollto" href="/record/">運動紀錄</a></li>
                    <li><a class="nav-link scrollto" href="/wisdomQA/">智慧問答</a></li>
                    <li><a class="nav-link scrollto" href="/post/">文章列表</a></li>
                    <li><a class="nav-link scrollto" href="/development/">開發團隊</a></li>
                </ul>
                <i class="bi bi-list mobile-nav-toggle d-none"></i>
            </nav>

            {% if 'email' not in request.COOKIES.keys %}
            <a class="btn-getstarted scrollto" href="/login/">登入</a>
            {% else %}
            <a class="btn-getstarted scrollto" href="/logout/">登出</a>
            {% endif %}
        </div>
    </header><!-- End Header -->

    <div class="row" style="display: flex; justify-content: space-between;">
        <section id="hero-animated" class="hero-animated d-flex align-items-center">
            <div class="container d-flex flex-column justify-content-center align-items-center text-center position-relative" data-aos="zoom-out">
                <!-- Buttons to switch charts -->
                <div class="button-container">
                    <button onclick="showChart('comboChartContainer')">臥推次數與時長分析圖</button>
                    <button onclick="showChart('lineChartContainer')">平均臥推次數分析圖</button>
                    <button onclick="showChart('pieChartContainer')">左右手錯誤率分析圖</button>
                </div>

                <!-- Charts -->
                <div id="lineChartContainer" class="chart-container line-chart-container" style="display: none;">
                    <canvas id="lineChart"></canvas>
                </div>

                <div id="pieChartContainer" class="chart-container pie-chart-container" style="display: none;">
                    <canvas id="pieChart"></canvas>
                </div>

                <div id="comboChartContainer" class="chart-container combo-chart-container" style="display: none;">
                    <canvas id="comboChart"></canvas>
                </div>

                <!-- Display Records -->
                <div class="record-container">
                    {% if record %}
                        {% for r in record %}
                            <div>
                                <p>次数: {{ r.count }}</p>
                                <p>时间: {{ r.datetime }}</p>
                                <p>左侧错误: {{ r.left_errors }}</p>
                                <p>右侧错误: {{ r.right_errors }}</p>
                                <p>运动时长: {{ r.sport_time }}</p>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p>没有找到运动记录。</p>
                    {% endif %}
                    <pre>{{ record|default:"未找到记录" }}</pre>  <!-- Debugging line -->
                </div>
            </div>
        </section>
    </div>

    <!-- Vendor JS Files -->
    <script src="/static/vendor/aos/aos.js"></script>
    <script src="/static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/static/vendor/glightbox/js/glightbox.min.js"></script>
    <script src="/static/vendor/swiper/swiper-bundle.min.js"></script>

    <!-- Template Main JS File -->
    <script src="/static/js/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

    <script>
        function showChart(chartId) {
            const charts = document.querySelectorAll('.chart-container');
            charts.forEach(chart => chart.style.display = 'none'); // 隐藏所有图表
            document.getElementById(chartId).style.display = 'block'; // 显示所选图表
        }

        // 页面加载时默认显示组合图表
        document.addEventListener('DOMContentLoaded', function () {
            showChart('comboChartContainer'); // 默认显示组合图表

            // 从API获取数据
            fetch('/api/record/')
                .then(response => {
                    if (!response.ok) {
                        return response.text().then(text => {
                            throw new Error(`HTTP错误！状态: ${response.status}. 响应: ${text}`);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('收到的数据:', data);
                    const dates = data.map(item => item.datetime);
                    const counts = data.map(item => item.count);
                    const sportTimes = data.map(item => item.sport_time);
                    const leftErrors = data.map(item => item.left_errors);
                    const rightErrors = data.map(item => item.right_errors);

                    // 线性图表数据（臥推次数）
                    const lineChartConfig = {
                        type: 'line',
                        data: {
                            labels: dates,
                            datasets: [{
                                label: '臥推次數',
                                data: counts,
                                borderColor: 'rgb(75, 192, 192)',
                                backgroundColor: 'rgba(75, 192, 192, 0.5)',
                                pointStyle: 'circle',
                                pointRadius: 5,
                                pointHoverRadius: 7
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: '臥推次數分析圖'
                                }
                            }
                        }
                    };
                    new Chart(document.getElementById('lineChart'), lineChartConfig);

                    // 饼状图数据（左右手错误率）
                    const pieChartConfig = {
                        type: 'pie',
                        data: {
                            labels: ['左侧错误', '右侧错误'],
                            datasets: [{
                                data: [leftErrors.reduce((a, b) => a + b, 0), rightErrors.reduce((a, b) => a + b, 0)],
                                backgroundColor: ['rgba(75, 192, 192, 0.6)', 'rgba(255, 99, 132, 0.6)']
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: '左右手錯誤率分析圖'
                                }
                            }
                        }
                    };
                    new Chart(document.getElementById('pieChart'), pieChartConfig);

                    // 组合图表数据（臥推次数与运动时长）
                    const comboChartConfig = {
                        type: 'bar',
                        data: {
                            labels: dates,
                            datasets: [{
                                label: '臥推次數',
                                data: counts,
                                backgroundColor: 'rgba(75, 192, 192, 0.5)',
                                borderColor: 'rgba(75, 192, 192, 1)',
                                borderWidth: 1
                            }, {
                                label: '運動時長',
                                type: 'line',
                                data: sportTimes,
                                borderColor: 'rgba(255, 99, 132, 1)',
                                backgroundColor: 'rgba(255, 99, 132, 0.5)',
                                fill: false,
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: '次數 / 時間 (秒)'
                                    }
                                }
                            },
                            plugins: {
                                title: {
                                    display: true,
                                    text: '臥推次數與運動時長分析圖'
                                }
                            }
                        }
                    };
                    new Chart(document.getElementById('comboChart'), comboChartConfig);
                })
                .catch(error => console.error('获取数据时出错:', error));
        });
    </script>
</body>

</html>
